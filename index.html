<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aero – Your AI Project Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --border-soft: #1f2937;
      --accent-strong: #38bdf8;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0ea5e9 0, #020617 40%, #000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #page-root {
      width: 100%;
      max-width: 1100px;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* Big card for the D-ID agent */
    .aero-portrait {
      width: 100%;
      max-width: 720px;
      height: 420px;
      border-radius: 28px;
      overflow: hidden;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top, #0ea5e9 0, #020617 55%, #020617 100%);
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.85);
      position: relative;
      margin: 0 auto;
    }

    .aero-portrait::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 60%);
      pointer-events: none;
    }

    #d-id-avatar {
      width: 100%;
      height: 100%;
    }

    /* Make the internal D-ID element fill the card */
    #d-id-avatar > * {
      width: 100% !important;
      height: 100% !important;
      border-radius: 28px;
    }

    /* Upload / analysis panel */
    .upload-panel {
      max-width: 720px;
      margin: 0 auto;
      background: rgba(2, 6, 23, 0.92);
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 14px 16px 16px;
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.6);
      font-size: 0.9rem;
    }

    .upload-panel h2 {
      margin: 0 0 4px;
      font-size: 1.1rem;
      color: #f9fafb;
    }

    .upload-panel p {
      margin: 0 0 10px;
      color: #9ca3af;
      font-size: 0.85rem;
    }

    .upload-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    #schedule-file {
      flex: 1;
      min-width: 220px;
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 6px;
      color: #e5e7eb;
      font-size: 0.85rem;
    }

    .upload-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: linear-gradient(135deg, #0ea5e9, #2563eb);
      color: #f9fafb;
      white-space: nowrap;
    }

    .upload-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    #upload-status {
      font-size: 0.8rem;
      color: #9ca3af;
      min-height: 1.2em;
    }

    #analysis-result {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #111827;
      font-size: 0.86rem;
      color: #e5e7eb;
      max-height: 260px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div id="page-root">
    <div class="aero-portrait" id="aero-portrait">
      <!-- D-ID Agent will render inside this -->
      <div id="d-id-avatar"></div>
    </div>

    <section class="upload-panel">
      <h2>Upload a project schedule for risk review</h2>
      <p>
        Export your schedule as a <strong>CSV</strong> (from MS Project, Smartsheet, Excel, etc.),
        and Ray will scan it for schedule risks, tight dependencies, and milestones at risk.
      </p>

      <div class="upload-row">
        <input type="file" id="schedule-file" accept=".csv" />
        <button id="analyze-btn" class="upload-btn">Analyze schedule</button>
      </div>
      <div id="upload-status"></div>
      <div id="analysis-result"></div>
    </section>
  </div>

  <!-- D-ID Agent embed: FULL mode (mic always on unless muted) -->
  <script
    type="module"
    src="https://agent.d-id.com/v2/index.js"
    data-mode="full"
    data-client-key="YXV0aDB8NjkyNzcwOTllYWM2MGViY2FkNzg3ZjkyOlM5YjFic0tIdHBMQmZRVHhNaXRVaw=="
    data-agent-id="v2_agt_5zuKUXBH"
    data-name="did-agent"
    data-monitor="true"
    data-target-id="d-id-avatar">
  </script>

  <script>
    // ---------- FRONTEND FILE UPLOAD LOGIC ----------
    const UPLOAD_URL = "https://projectpilot-backend-zkad.onrender.com/api/upload-schedule";

    const fileInput = document.getElementById("schedule-file");
    const analyzeBtn = document.getElementById("analyze-btn");
    const statusEl = document.getElementById("upload-status");
    const resultEl = document.getElementById("analysis-result");

    analyzeBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        statusEl.textContent = "Please choose a CSV file first.";
        return;
      }

      const formData = new FormData();
      formData.append("schedule", file);

      analyzeBtn.disabled = true;
      statusEl.textContent = "Uploading and analyzing your schedule...";
      resultEl.textContent = "";

      try {
        const res = await fetch(UPLOAD_URL, {
          method: "POST",
          body: formData,
        });

        if (!res.ok) {
          const text = await res.text();
          console.error("Upload error:", text);
          statusEl.textContent =
            "There was an error analyzing the file. Please check that it's a CSV export.";
          return;
        }

        const data = await res.json();
        if (data.error) {
          statusEl.textContent = data.error;
          return;
        }

        statusEl.textContent = "Here’s Ray’s assessment of your schedule:";
        resultEl.textContent = data.analysis || "No analysis returned.";
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Something went wrong contacting the server. Please try again in a moment.";
      } finally {
        analyzeBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
